<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Holesky Block Height</title>

  <!-- 100 % working ethers.js UMD (no SRI, avoids hash-mismatch) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <style>
    body { font-family: system-ui, sans-serif; text-align:center; margin:3rem auto; max-width:32rem; }
    button { padding:.7rem 1.5rem; font-size:1rem; cursor:pointer; margin-top:1.2rem; }
    #height { margin-top:1.5rem; font-size:1.3rem; font-weight:600; }
  </style>
</head>
<body>

  <h1>Holesky Block Height</h1>

  <button id="btn">Connect wallet</button>
  <div id="height">—</div>

  <script>
    const btn    = document.getElementById('btn');
    const height = document.getElementById('height');
    let provider = null;        // will hold ethers.BrowserProvider

    async function connect() {
      if (!window.ethereum) {
        alert('MetaMask (or another injected wallet) is required.');
        return;
      }

      try {
        // Ask user to connect
        await window.ethereum.request({ method: 'eth_requestAccounts' });

        // Wrap MetaMask in an ethers provider
        provider = new ethers.BrowserProvider(window.ethereum);

        // Make sure we’re on Holesky
        const { chainId } = await provider.getNetwork();
        if (Number(chainId) !== 17000) {
          alert('Please switch MetaMask to the Holesky testnet (chain ID 17000) and reload.');
          return;
        }

        btn.textContent = 'Refresh';
        await refresh();        // auto-show once connected
      } catch (err) {
        console.error(err);
        height.textContent = 'Error: ' + (err.message ?? err);
      }
    }

    async function refresh() {
      if (!provider) {
        await connect();
        return;
      }
      try {
        const block = await provider.getBlockNumber();
        height.textContent = `Current Holesky block: ${block.toLocaleString('en-US')}`;
      } catch (err) {
        console.error(err);
        height.textContent = 'Error: ' + (err.message ?? err);
      }
    }

    btn.addEventListener('click', () => {
      (btn.textContent === 'Connect wallet') ? connect() : refresh();
    });

    /* Auto-connect if the user already authorised the site earlier */
    if (window.ethereum && window.ethereum.selectedAddress) {
      connect();
    }
  </script>
</body>
</html>
